# Task 1 - Iso-data Intensity Thresholding

The purpose of the task 1 is to compute a threshold value that can divide all the pixels into two groups - foreground and background. 

I initially set the threshold value to 127 which is the median number between 0 to 255. The threshold value `t` will be computed using an iterative method. During each iteration, the mean value of all the foreground pixels and background pixels will be computed, called $u_0$ and $u_1$ respectively. And new value `t_new` will be generated using the equation $t_{new} = (u_0 + u_1) / 2$. Then subtract `t` with `t_new`. Stop iteration when the absolute value of the result of the subtraction less than 0.01, otherwise update the value of `t`.

Here is a graph showing the value of `t` changing in each iteration:

<img src=".\report_img\rice_img2_Task1_threshold_change.png" alt="rice_img2_Task1_threshold_change" style="zoom: 80%;" />

In this way, main objects in the image will be filtered out along with some noises. We replace the pixels of the foreground with 0 and 255 for the background, we'll get the first image:

<img src=".\report_img\rice_img2_Task1.png" alt="rice_img2_Task1" style="zoom:67%;" />

It can be clearly seen that there are lots of noises. But this is enough for task 1, the task 2 will draw attention to this issue.



# Task 2 - Counting the Rice Kernels

Task 2 is more complicated than the previous one. To solve this question, we have to firstly filter out the noise and then apply the two-pass connected components algorithm to the image. 



## Median Filter

Since the image generated by the task 1 is a bi-modal image, median filter is more suitable for this task. To implement the median filter, we have to expand the border of the image, and then compute value for each pixel using `numpy.median`. 

In order to filter out noises having relatively big area, I used a kernel size of 9 * 9 for this question.

The image filtered by the median filter is shown below:

<img src=".\report_img\rice_img2_Task2_Median_Filter.png" alt="rice_img2_Task2_Median_Filter" style="zoom:67%;" />

You can see almost all the noises disappears, the result is quite satisfying.



## Two-pass Connected Algorithm

The idea of the two-pass connected algorithm is to label the connected pixels with an unique value. 

It will scan the image pixel by pixel horizontally then vertically. Each step will label a pixel with either a new label or a used label. This was called the first pass. The first pass will also record the relationship of the labels - some labels are actually representing the same component. The second pass will check the relationship of labels and replace them with the smallest value it can be. After the second pass, we can count the rice kernels in the picture by counting how many labels are there.

Since the labels are actually integers, they can be interpreted as colors with different gray scale. So the result can be directly observed though an image.

<img src=".\report_img\rice_img2_Task2.png" alt="rice_img2_Task2" style="zoom:67%;" />

You can see that as the rice kernels getting closer to the bottom, the color gets lighter. The change in gray scale shows the value of labels increase, which is the expected image of this task.



# Task 3 - Percentage of Damaged Rice Kernels

The task 3 will give a minimum size that a rice kernel should be considered as intact. 

We can use `numpy.ma.masked_not_equal` to count the number of pixels of each label appeared. When the amount of one label is smaller than the minimum size, it will be considered as damaged. If the amount of a label is greater or equal to the minimum pixel area, it will be considered as a whole rice kernel.

By counting the labels, we can finally get the percentage of damaged kernels. It should be $\frac{damaged\ kernels}{all\ kernels}$.

After knowing which rice kernels are damaged, we can start changing the value of these labels to 255. This will turn their color from gray to white. Also, the value of whole rice kernels will be changed to 0.   

<img src=".\report_img\rice_img2_Task3.png" alt="rice_img2_Task3" style="zoom:67%;" />